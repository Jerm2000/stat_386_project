---
title: "Tutorial"
format:
  html:
    toc: true
    code-fold: false
    code-tools: true
execute:
  warning: false
  message: false
---

This tutorial demonstrates how to use the **`jerm2000-stat-386-project`** Python package to reproduce the analysis of MLB home run distance, exit velocity, and barrel metrics.

The tutorial assumes:

- you are using the package installed from **PyPI**
- you do **not** need to clone the GitHub repository
- you are working in a Python environment (script, notebook, or Quarto)

---

## Step 0: Install the package

Install the package from PyPI:

```bash
pip3 install jerm2000-stat-386-project
```

---

## Step 1: Generate the dataset

The analysis uses a combined hitter-level dataset saved as:

- `data/combined_leaders_2025.csv`

To generate the dataset using the installed package, run the following command in your terminal:

```bash
python3 -m stat386_project.fetch_data
```

This will:

- query Statcast using `pybaseball`
- filter to home runs
- compute hitter-level summary statistics
- merge in barrel metrics (downloaded automatically if not available locally)
- create:

  - `data/hr_distance_leaders_2025.csv`
  - `data/combined_leaders_2025.csv`

**Note:** This step requires an internet connection and may take a minute to run.

---

## Step 2: Load and prepare the data in Python

```{python}
from stat386_project.analysis import load_combined, prepare_data

df_raw = load_combined("data/combined_leaders_2025.csv")
df = prepare_data(df_raw, min_hr=5)

df_raw.shape, df.shape
```

**What this does**

- `load_combined()` reads `data/combined_leaders_2025.csv`
- `prepare_data()` applies filtering rules used in the project:

  - keep hitters with at least 5 home runs
  - remove rows missing key metrics needed for plots/tables

---

## Step 3: Generate the main summary tables

### 3.1 Longest HR vs average HR distance

```{python}
from stat386_project.analysis import longest_vs_avg_distance

longest_vs_avg_distance(df, n=10)
```

**How to interpret**
- Players are ranked by `max_hr_distance`
- `avg_hr_distance` shows whether their typical home run distance is also high
- exit velocity columns provide context for how consistently hard the player hits the ball

---

### 3.2 Barrel percentage leaders (quality of contact)

```{python}
from stat386_project.analysis import barrel_power_table

barrel_power_table(df, n=10)
```

**How to interpret**
- `brl_percent` (barrel percentage) is a measure of high-quality contact
- the other columns provide context about distance and exit velocity

---

### 3.3 Workload vs average distance

```{python}
from stat386_project.analysis import workload_vs_distance

workload_vs_distance(df).sort_values("hr_count", ascending=False).head(10)
```

**How to interpret**
- shows whether hitters with many home runs also tend to hit longer home runs on average

---

## Step 4: Correlations among key metrics

```{python}
from stat386_project.analysis import correlation_table

correlation_table(df).round(3)
```

**How to interpret**
- larger positive values indicate metrics that tend to be high for the same hitters
- smaller values indicate metrics that capture different aspects of power/performance

---

## Step 5: Identify standout hitters (outliers)

```{python}
from stat386_project.analysis import find_outliers

outliers = find_outliers(
    df,
    columns=("avg_hr_distance", "max_hr_distance", "avg_launch_speed"),
    z_thresh=2.5,
)

outliers[[
    "player_name",
    "hr_count",
    "avg_hr_distance", "avg_hr_distance_z",
    "max_hr_distance", "max_hr_distance_z",
    "avg_launch_speed", "avg_launch_speed_z",
]].head(25)
```

**Why this matters**
- This project is partly about whether “headline” max metrics reflect consistent skill
- outliers provide concrete examples to discuss in the report (not data errors)

---

## Step 6: Create the plots used in the report

The plotting functions return Matplotlib `Figure` objects. In a notebook or Quarto, they will display automatically when they are the last line. In a plain Python script, you should call `plt.show()` after creating the figure.

### 6.1 Max vs average home run distance

```{python}
from stat386_project.analysis import plot_max_vs_avg_distance
import matplotlib.pyplot as plt

fig = plot_max_vs_avg_distance(df)
plt.show()
```

### 6.2 Exit velocity vs average home run distance

```{python}
from stat386_project.analysis import plot_launch_speed_vs_distance
import matplotlib.pyplot as plt

fig = plot_launch_speed_vs_distance(df)
plt.show()
```

### 6.3 Barrel percentage vs average home run distance

```{python}
from stat386_project.analysis import plot_barrel_percent_vs_distance
import matplotlib.pyplot as plt

fig = plot_barrel_percent_vs_distance(df)
plt.show()
```

### 6.4 Home run count vs average home run distance

```{python}
from stat386_project.analysis import plot_hr_count_vs_distance
import matplotlib.pyplot as plt

fig = plot_hr_count_vs_distance(df)
plt.show()
```

---

## Summary

Using the PyPI package, the workflow is:

1. Install the package (`pip install jerm2000-stat-386-project`)
2. Generate the dataset (`python -m stat386_project.fetch_data`)
3. Load and clean the dataset (`load_combined()` → `prepare_data()`)
4. Run summary tables, correlations, outliers, and plots

For detailed function reference (inputs/outputs), see the **Documentation** page.
